---
title: "prep PRISM LINCS klaeger data"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(here)
library(webchem)
```

```{r}
#read in data 
cardio_toxicity_data = read_csv(here('data/cardio_toxicity_data.csv'))
LINCS_klaeger_data_wide = read_csv(here('results/all_klaeger_LINCS_data_for_ml_wide_matched_only.csv'))
LINCS_klaeger_cids = read_csv(here('results/matching/kinomescan_klaeger_cids.csv')) %>% 
	mutate(cid = as.character(cid))
```

```{r}
#variable renaming
cardio_toxicity_data_processed = cardio_toxicity_data %>% 
	mutate(across(-Drug, ~as.factor(.))) %>% 
	rename(drug = Drug)
```

```{r}
#find drug matches

cardio_cids = get_cid(unique(cardio_toxicity_data_processed$drug), from = "name", domain = "compound", match = "all", verbose = T)

drug_matches = cardio_cids %>% 
	rename(cardio_drug_name = query) %>% 
	inner_join(LINCS_klaeger_cids)

#change PFE_PKIS-10 to Lorlatinib for joining 
LINCS_klaeger_data_wide_processed = LINCS_klaeger_data_wide %>% 
		mutate(drug = if_else(
		drug == "PFE-PKIS 10",
		"Lorlatinib",
		drug
	))
```



```{r}
all_model_data = cardio_toxicity_data_processed %>% 
	left_join(LINCS_klaeger_data_wide_processed) %>% 
	drop_na() 

write_rds(all_model_data,
					here('results/cardio_toxicity_models/cardio_toxicity_data_for_ml.rds.gz'), compress = "gz")
```